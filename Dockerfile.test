# Red Hat Status Checker - # Copy application files
COPY redhat_status/ ./redhat_status/
COPY redhat_status.py .
COPY config.json .ng Container
FROM python:3.11-slim

# Set working directory
WORKDIR /app

# Set environment variables for testing
ENV PYTHONPATH=/app
ENV PYTHONDONTWRITEBYTECODE=1
ENV PYTHONUNBUFFERED=1
ENV TESTING=1

# Install system dependencies including git for testing
RUN apt-get update && apt-get install -y \
    curl \
    git \
    && rm -rf /var/lib/apt/lists/*

# Copy requirements first for better Docker layer caching
COPY requirements.txt .

# Install Python dependencies including test dependencies
RUN pip install --no-cache-dir -r requirements.txt

# Install additional test dependencies that might not be in requirements.txt
RUN pip install --no-cache-dir pytest-xvfb pytest-timeout pytest-mock

# Copy application code
COPY redhat_status/ ./redhat_status/
COPY redhat_status.py .
COPY config.json .
COPY pytest.ini .
COPY run_tests.py .

# Copy test files
COPY tests/ ./tests/

# Create non-root user for security
RUN groupadd -r testuser && useradd -r -g testuser testuser
RUN chown -R testuser:testuser /app
USER testuser

# Create directories for test outputs
RUN mkdir -p /app/test-results /app/coverage-reports

# Default command runs comprehensive tests
CMD ["python3", "run_tests.py", "--all"]

# Labels for metadata
LABEL maintainer="Red Hat Status Test Team"
LABEL version="3.1.0"
LABEL description="Red Hat Status Checker - Testing Container"
LABEL purpose="Unit and integration testing in isolated environment"
